<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dragon Tiger Analyser</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
    }

    header img {
      margin-top: 10px;
      width: 120px;
    }

    #video {
      margin-top: 15px;
      width: 90%;
      max-width: 400px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.8);
    }

    /* Thin selection box */
    #selectionBox {
      position: absolute;
      border: 2px dashed #00ffcc;
      pointer-events: none;
      width: 80%;
      height: 60px;
      top: 40%;
      left: 10%;
      border-radius: 8px;
    }

    #popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 25px;
      background: #222;
      border-radius: 12px;
      font-size: 1.3rem;
      font-weight: bold;
      z-index: 1000;
      box-shadow: 0 0 20px rgba(0,255,200,0.6);
    }

    .btn {
      margin: 12px;
      padding: 12px 25px;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: white;
      transition: 0.3s;
    }
    .btn:hover {
      opacity: 0.8;
    }

    .links {
      margin-top: 20px;
      padding: 15px;
      background: #222;
      border-radius: 12px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .links a {
      text-decoration: none;
      padding: 10px 18px;
      border-radius: 8px;
      background: #444;
      color: #fff;
      font-weight: bold;
      transition: 0.3s;
    }
    .links a:hover {
      background: #00ffcc;
      color: #000;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo">
  </header>

  <main>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <div id="selectionBox"></div>

    <div>
      <button id="startBtn" class="btn">üé• Start Camera</button>
      <button id="captureAnalyseBtn" class="btn">üì∏ Capture & Analyse</button>
    </div>

    <div id="popup"></div>
  </main>

  <footer>
    <div class="links">
      <a href="https://game.teenpatty-master.com/f2RkdFx0UUJ4fQo=" target="_blank">üéÆ Game Link</a>
      <a href="https://t.me/+0_sTcsu0kA03YjA1" target="_blank">üì¢ Channel Link</a>
    </div>
  </footer>

  <!-- Tesseract OCR -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.4/dist/tesseract.min.js"></script>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const popup = document.getElementById('popup');
    const startBtn = document.getElementById('startBtn');
    const captureAnalyseBtn = document.getElementById('captureAnalyseBtn');
    let stream;

    // Mobile only
    function isMobile() {
      return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }
    window.onload = () => {
      if (!isMobile()) {
        showPopup("‚ö†Ô∏è Please open on mobile device.");
        startBtn.disabled = true;
        captureAnalyseBtn.disabled = true;
      }
    };

    // Start Camera
    startBtn.addEventListener('click', async () => {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
      } catch {
        showPopup("‚ö†Ô∏è Camera not accessible!");
      }
    });

    // Capture & Analyse
    captureAnalyseBtn.addEventListener('click', async () => {
      if (!stream) {
        showPopup("‚ö†Ô∏è Start camera first!");
        return;
      }

      // Freeze frame
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      video.pause();

      showPopup("üîé Analysing...");
      const { data: { text } } = await Tesseract.recognize(canvas, 'eng');

      setTimeout(() => {
        const result = analyseHistory(text);
        showPopup(result);

        setTimeout(() => {
          popup.style.display = "none";
          video.play();
        }, 3000);
      }, 2000);
    });

    // Analyse Logic
    function analyseHistory(text) {
      const history = text.match(/dragon|tiger|tie/gi);
      if (!history || history.length < 5) {
        return "‚ö†Ô∏è Invalid capture, show Dragon Tiger history!";
      }

      const last20 = history.slice(-20).map(h => h.toLowerCase());
      let dragonCount = last20.filter(h => h.includes("dragon")).length;
      let tigerCount = last20.filter(h => h.includes("tiger")).length;

      if (dragonCount > tigerCount) return "üêØ Next: Tiger";
      if (tigerCount > dragonCount) return "üêâ Next: Dragon";
      return "‚öñÔ∏è Equal trend!";
    }

    // Popup
    function showPopup(text) {
      popup.textContent = text;
      popup.style.display = "block";
    }
  </script>
</body>
</html>
