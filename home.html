<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dragon Tiger Analyser</title>
  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: #0d0d0d;
      color: #fff;
      text-align: center;
    }

    header img {
      margin-top: 15px;
      width: 120px;
    }

    #video {
      margin-top: 20px;
      width: 90%;
      max-width: 380px;
      border-radius: 16px;
      border: 3px solid #00eaff;
      box-shadow: 0 0 30px rgba(0, 234, 255, 0.4);
    }

    /* Neon thin kinw box */
    #selectionBox {
      position: absolute;
      border: 2px dashed #00eaff;
      pointer-events: none;
      width: 75%;
      height: 55px;
      top: 42%;
      left: 12.5%;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 234, 255, 0.7);
      background: rgba(0, 0, 0, 0.2);
      backdrop-filter: blur(4px);
    }

    #popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 25px 35px;
      border-radius: 15px;
      font-size: 1.4rem;
      font-weight: bold;
      z-index: 1000;
      min-width: 200px;
      text-align: center;
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -48%); }
      to { opacity: 1; transform: translate(-50%, -50%); }
    }

    .btn {
      margin: 14px 8px;
      padding: 12px 28px;
      font-size: 1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.5);
      transition: all 0.3s;
    }
    .btn:hover {
      transform: translateY(-2px);
      opacity: 0.9;
    }

    .links {
      margin-top: 25px;
      padding: 18px;
      background: #1a1a1a;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(0,255,200,0.3);
      display: flex;
      justify-content: center;
      gap: 25px;
    }

    .links a {
      text-decoration: none;
      padding: 12px 20px;
      border-radius: 10px;
      background: #333;
      color: #fff;
      font-weight: bold;
      transition: 0.3s;
    }
    .links a:hover {
      background: #00ffcc;
      color: #000;
      box-shadow: 0 0 12px #00ffcc;
    }

    /* Popup Result Themes */
    .dragon {
      background: #001f3f;
      color: #00eaff;
      box-shadow: 0 0 25px rgba(0, 234, 255, 0.8);
    }
    .tiger {
      background: #2e0d0d;
      color: #ff5733;
      box-shadow: 0 0 25px rgba(255, 87, 51, 0.8);
    }
    .tie {
      background: #001a26;
      color: #00d4ff;
      box-shadow: 0 0 25px rgba(0, 212, 255, 0.8);
    }
    .error {
      background: #260000;
      color: #ff4d4d;
      box-shadow: 0 0 20px rgba(255,0,0,0.6);
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo">
  </header>

  <main>
    <video id="video" autoplay playsinline></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <div id="selectionBox"></div>

    <div>
      <button id="startBtn" class="btn">üé• Start Camera</button>
      <button id="captureAnalyseBtn" class="btn">üì∏ Capture & Analyse</button>
    </div>

    <div id="popup"></div>
  </main>

  <footer>
    <div class="links">
      <a href="https://game.teenpatty-master.com/f2RkdFx0UUJ4fQo=" target="_blank">üéÆ Game Link</a>
      <a href="https://t.me/+0_sTcsu0kA03YjA1" target="_blank">üì¢ Channel Link</a>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.4/dist/tesseract.min.js"></script>
  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const popup = document.getElementById('popup');
    const startBtn = document.getElementById('startBtn');
    const captureAnalyseBtn = document.getElementById('captureAnalyseBtn');
    let stream;

    function isMobile() {
      return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
    }
    window.onload = () => {
      if (!isMobile()) {
        showPopup("‚ö†Ô∏è Please open on mobile device.", "error");
        startBtn.disabled = true;
        captureAnalyseBtn.disabled = true;
      }
    };

    startBtn.addEventListener('click', async () => {
      try {
        stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
      } catch {
        showPopup("‚ö†Ô∏è Camera not accessible!", "error");
      }
    });

    captureAnalyseBtn.addEventListener('click', async () => {
      if (!stream) {
        showPopup("‚ö†Ô∏è Start camera first!", "error");
        return;
      }

      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      video.pause();

      showPopup("üîé Analysing...", "tie");

      const { data: { text } } = await Tesseract.recognize(canvas, 'eng');

      setTimeout(() => {
        const { result, theme } = analyseHistory(text);
        showPopup(result, theme);

        setTimeout(() => {
          popup.style.display = "none";
          video.play();
        }, 3000);
      }, 2000);
    });

    function analyseHistory(text) {
      const history = text.match(/dragon|tiger|tie/gi);
      if (!history || history.length < 5) {
        return { result: "‚ö†Ô∏è Invalid capture, show Dragon Tiger history!", theme: "error" };
      }

      const last20 = history.slice(-20).map(h => h.toLowerCase());
      let dragonCount = last20.filter(h => h.includes("dragon")).length;
      let tigerCount = last20.filter(h => h.includes("tiger")).length;

      if (dragonCount > tigerCount) return { result: "üêØ Next: Tiger", theme: "tiger" };
      if (tigerCount > dragonCount) return { result: "üêâ Next: Dragon", theme: "dragon" };
      return { result: "‚öñÔ∏è Equal trend!", theme: "tie" };
    }

    function showPopup(text, theme) {
      popup.textContent = text;
      popup.className = theme;
      popup.style.display = "block";
    }
  </script>
</body>
</html>
